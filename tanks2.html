<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ö–∞—Ç–∞–ª–æ–≥ —Ç–∞–Ω–∫–æ–≤</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <link rel="stylesheet" href="styles1.css">
</head>
<body>
    <header>
        <nav>
            <button class="nav-button">–ì–ª–∞–≤–Ω–∞—è</button>
            <button class="nav-button">–°–∞–º–æ–ª—ë—Ç—ã</button>
            <button class="nav-button">–ö–æ—Ä–∞–±–ª–∏</button>
            <button class="nav-button">–û—Ä—É–¥–∏—è</button>
        </nav>
    </header>

    <div class="filters-section">
        <div class="filter-group">
            <span>–°—Ç—Ä–∞–Ω–∞: </span>
            <button class="filter-button" data-filter="country" value="germany">–ì–µ—Ä–º–∞–Ω–∏—è</button>
            <button class="filter-button" data-filter="country" value="ussr">–°–°–°–†</button>
            <button class="filter-button" data-filter="country" value="usa">–°–®–ê</button>
            <button class="filter-button" data-filter="country" value="britain">–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è</button>
        </div>
        
        <div class="filter-group">
            <span>–¢–∏–ø: </span>
            <button class="filter-button" data-filter="type" value="heavy">–¢—è–∂–µ–ª—ã–π</button>
            <button class="filter-button" data-filter="type" value="medium">–°—Ä–µ–¥–Ω–∏–π</button>
            <button class="filter-button" data-filter="type" value="light">–õ–µ–≥–∫–∏–π</button>
            <button class="filter-button" data-filter="type" value="pt-sau">–ü–¢ –°–ê–£</button>
        </div>
        
        <button id="reset-filters">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
    </div>

    <div id="auth-container">
        <button id="admin-login">–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</button>
        <button id="admin-logout" style="display: none;">–í—ã—Ö–æ–¥</button>
    </div>

    <div class="admin-panel">
        <div class="admin-panel-header">
            <h3>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h3>
            <button class="toggle-panel">‚ñº</button>
        </div>
        <div class="admin-panel-content">
            <form id="tank-form">
                <!-- –ü–µ—Ä–≤—ã–π —Ä—è–¥ -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                        <input type="text" name="name" placeholder="–¢-34" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–°—Ç—Ä–∞–Ω–∞</label>
                        <select name="country" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É</option>
                            <option value="ussr">–°–°–°–†</option>
                            <option value="germany">–ì–µ—Ä–º–∞–Ω–∏—è</option>
                            <option value="britain">–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è</option>
                            <option value="usa">–°–®–ê</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–¢–∏–ø</label>
                        <select name="type" required>
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø</option>
                            <option value="heavy">–¢—è–∂–µ–ª—ã–π</option>
                            <option value="medium">–°—Ä–µ–¥–Ω–∏–π</option>
                            <option value="light">–õ–µ–≥–∫–∏–π</option>
                            <option value="pt-sau">–ü–¢-–°–ê–£</option>
                        </select>
                    </div>
                </div>
    
                <!-- –í—Ç–æ—Ä–æ–π —Ä—è–¥ -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">–°–∫–æ—Ä–æ—Å—Ç—å (–∫–º/—á)</label>
                        <input type="number" name="speed" placeholder="50">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–î–≤–∏–≥–∞—Ç–µ–ª—å</label>
                        <input type="text" name="engine" placeholder="V-2-34">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ë—Ä–æ–Ω—è (–º–º)</label>
                        <input type="text" name="armor" placeholder="45-90">
                    </div>
                </div>
    
                <!-- –¢—Ä–µ—Ç–∏–π —Ä—è–¥ -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">–í–æ–æ—Ä—É–∂–µ–Ω–∏–µ</label>
                        <input type="text" name="armament" placeholder="76-–º–º –ø—É—à–∫–∞ –§-34">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–ì–æ–¥—ã –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</label>
                        <input type="text" name="productionYears" placeholder="1940-1945">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">–≠–∫–∏–ø–∞–∂</label>
                        <input type="number" name="crew" placeholder="4">
                    </div>
                </div>
    
                <!-- –ß–µ—Ç–≤–µ—Ä—Ç—ã–π —Ä—è–¥ -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">–ú–∞—Å—Å–∞ (—Ç–æ–Ω–Ω)</label>
                        <input type="number" name="weight" placeholder="26">
                    </div>
                    
                    <div class="form-group full-width">
                        <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                        <textarea name="description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Ö–Ω–∏–∫–∏..."></textarea>
                    </div>
                    
                    <div class="form-group full-width">
                        <label class="form-label">–°—Å—ã–ª–∫–∞ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
                        <input type="url" name="image" placeholder="https://example.com/image.jpg">
                    </div>
    
                    <div class="form-group full-width">
                        <label class="form-label">–°—Å—ã–ª–∫–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ç–∞–Ω–∫–∞</label>
                        <input type="url" name="page_url" placeholder="https://example.com/tank-page">
                    </div>
                </div>
    
                <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
                <div class="form-row">
                    <button type="submit" class="full-width">–î–æ–±–∞–≤–∏—Ç—å —Ç–∞–Ω–∫</button>
                </div>
            </form>
        </div>
    </div>

    <div class="tanks-container" id="tanks-list">
        <div class="country-section" data-country="germany">
            <h2 class="country-header">üá©üá™ –ì–µ—Ä–º–∞–Ω–∏—è</h2>
            <div class="tanks-group"></div>
        </div>
        <div class="country-section" data-country="ussr">
            <h2 class="country-header">üá∑üá∫ –°–°–°–†</h2>
            <div class="tanks-group"></div>
        </div>
        <div class="country-section" data-country="usa">
            <h2 class="country-header">üá∫üá∏ –°–®–ê</h2>
            <div class="tanks-group"></div>
        </div>
        <div class="country-section" data-country="britain">
            <h2 class="country-header">üá¨üáß –í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è</h2>
            <div class="tanks-group"></div>
        </div>
        <div class="country-section" data-country="other">
            <h2 class="country-header">üåç –î—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω—ã</h2>
            <div class="tanks-group"></div>
        </div>
    </div>

    <footer>
        <p>¬© 2024 –ö–∞—Ç–∞–ª–æ–≥ –≤–æ–µ–Ω–Ω–æ–π —Ç–µ—Ö–Ω–∏–∫–∏. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
    </footer>

    <div class="auth-modal" id="auth-modal">
        <div class="auth-form">
            <h3>–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</h3>
            <input type="email" class="auth-input" id="email" placeholder="Email">
            <input type="password" class="auth-input" id="password" placeholder="–ü–∞—Ä–æ–ª—å">
            <p class="error-message" id="error-message"></p>
            <button id="signin-button">–í–æ–π—Ç–∏</button>
            <button id="close-auth">–ó–∞–∫—Ä—ã—Ç—å</button>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyD76m80D_TEYZ3cQO6qRr7QUv_KlhqCgXo",
            authDomain: "tanks-24afb.firebaseapp.com",
            projectId: "tanks-24afb",
            storageBucket: "tanks-24afb.appspot.com",
            messagingSenderId: "670820738006",
            appId: "670820738006"
        };
    
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
    
        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const state = {
            currentFilters: { country: null, type: null },
            tanks: [],
            unsubscribeTanks: null
        };
    
        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const elements = {
            authModal: document.getElementById('auth-modal'),
            email: document.getElementById('email'),
            password: document.getElementById('password'),
            errorMessage: document.getElementById('error-message'),
            adminPanel: document.querySelector('.admin-panel'),
            tanksList: document.getElementById('tanks-list'),
            filterButtons: document.querySelectorAll('.filter-button'),
            resetFilters: document.getElementById('reset-filters'),
            tankForm: document.getElementById('tank-form')
        };
    
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const init = () => {
            setupEventListeners();
            auth.onAuthStateChanged(handleAuthStateChanged);
            setupTanksListener();
        };
    
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        const setupEventListeners = () => {
            // –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
            document.getElementById('admin-login').addEventListener('click', () => elements.authModal.style.display = 'block');
            document.getElementById('close-auth').addEventListener('click', () => elements.authModal.style.display = 'none');
            document.getElementById('signin-button').addEventListener('click', handleSignIn);
            document.getElementById('admin-logout').addEventListener('click', handleSignOut);
    
            // –§–∏–ª—å—Ç—Ä—ã
            elements.filterButtons.forEach(btn => btn.addEventListener('click', () => handleFilterClick(btn)));
            elements.resetFilters.addEventListener('click', resetFilters);
    
            // –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
            document.querySelector('.admin-panel-header').addEventListener('click', toggleAdminPanel);
            elements.tankForm.addEventListener('submit', handleAddTank);
        };
    
        // –†–∞–±–æ—Ç–∞ —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π
        const handleSignIn = async (e) => {
            e.preventDefault();
            try {
                await auth.signInWithEmailAndPassword(elements.email.value, elements.password.value);
                elements.authModal.style.display = 'none';
                elements.errorMessage.textContent = '';
            } catch (error) {
                showError(error);
            }
        };
    
        const handleSignOut = () => auth.signOut();
    
        const handleAuthStateChanged = (user) => {
            if (user) {
                elements.adminPanel.style.display = 'block';
                document.getElementById('admin-login').style.display = 'none';
                document.getElementById('admin-logout').style.display = 'inline';
            } else {
                elements.adminPanel.style.display = 'none';
                document.getElementById('admin-login').style.display = 'inline';
                document.getElementById('admin-logout').style.display = 'none';
            }
        };
    
        // –†–∞–±–æ—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏
        const setupTanksListener = () => {
            if (state.unsubscribeTanks) state.unsubscribeTanks();
            
            state.unsubscribeTanks = db.collection('tanks')
                .orderBy('createdAt', 'desc')
                .onSnapshot(snapshot => {
                    state.tanks = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    renderTanks();
                }, error => showError(error));
        };
    
        const renderTanks = () => {
            const countries = {
                germany: document.querySelector('[data-country="germany"] .tanks-group'),
                ussr: document.querySelector('[data-country="ussr"] .tanks-group'),
                usa: document.querySelector('[data-country="usa"] .tanks-group'),
                britain: document.querySelector('[data-country="britain"] .tanks-group'),
                other: document.querySelector('[data-country="other"] .tanks-group')
            };
    
            Object.values(countries).forEach(section => section.innerHTML = '');
    
            state.tanks
                .filter(tank => matchesFilters(tank))
                .forEach(tank => {
                    const card = createTankCard(tank);
                    const country = getCountrySection(tank.country);
                    countries[country].appendChild(card);
                });
        };
    
        const createTankCard = (tank) => {
            const card = document.createElement('div');
            card.className = 'tank-card';
            card.innerHTML = `
                <a href="${tank.page_url || '#'}" class="tank-link" ${tank.page_url ? 'target="_blank"' : ''}>
                    <div class="tank-card-wrapper">
                        ${tank.image ? `
                        <div class="image-container">
                            <img src="${tank.image}" 
                                 alt="${tank.name}" 
                                 loading="lazy"
                                 onerror="this.style.display='none'">
                        </div>` : ''}
                        
                        <div class="tank-info">
                            <h3>${tank.name}</h3>
                            <p class="country-type">${getCountryName(tank.country)} ‚Ä¢ ${getTypeName(tank.type)}</p>
                        </div>
                        
                        <div class="tank-details">
                            <div class="detail-grid">
                                ${tank.speed ? `<div class="detail-item">
                                    <span>–°–∫–æ—Ä–æ—Å—Ç—å</span>
                                    <span>${tank.speed} –∫–º/—á</span>
                                </div>` : ''}
                                ${tank.engine ? `<div class="detail-item">
                                    <span>–î–≤–∏–≥–∞—Ç–µ–ª—å</span>
                                    <span>${tank.engine}</span>
                                </div>` : ''}
                                ${tank.armor ? `<div class="detail-item">
                                    <span>–ë—Ä–æ–Ω—è</span>
                                    <span>${tank.armor} –º–º</span>
                                </div>` : ''}
                                ${tank.armament ? `<div class="detail-item">
                                    <span>–í–æ–æ—Ä—É–∂–µ–Ω–∏–µ</span>
                                    <span>${tank.armament}</span>
                                </div>` : ''}
                                ${tank.productionYears ? `<div class="detail-item">
                                    <span>–ì–æ–¥—ã</span>
                                    <span>${tank.productionYears}</span>
                                </div>` : ''}
                                ${tank.crew ? `<div class="detail-item">
                                    <span>–≠–∫–∏–ø–∞–∂</span>
                                    <span>${tank.crew} —á–µ–ª</span>
                                </div>` : ''}
                                ${tank.weight ? `<div class="detail-item">
                                    <span>–ú–∞—Å—Å–∞</span>
                                    <span>${tank.weight} —Ç</span>
                                </div>` : ''}
                            </div>
                        </div>
                    </div>
                </a>
            `;
            return card;
        };
    
        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è
        const handleFilterClick = (button) => {
            const filterType = button.dataset.filter;
            const value = button.value;
            
            if (state.currentFilters[filterType] === value) {
                state.currentFilters[filterType] = null;
                button.classList.remove('active-filter');
            } else {
                state.currentFilters[filterType] = value;
                button.classList.add('active-filter');
            }
            renderTanks();
        };
    
        const resetFilters = () => {
            state.currentFilters = { country: null, type: null };
            document.querySelectorAll('.filter-button').forEach(btn => btn.classList.remove('active-filter'));
            renderTanks();
        };
    
        const matchesFilters = (tank) => {
            const countryMatch = !state.currentFilters.country || tank.country === state.currentFilters.country;
            const typeMatch = !state.currentFilters.type || tank.type === state.currentFilters.type;
            return countryMatch && typeMatch;
        };
    
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        const getCountrySection = (country) => {
            const validCountries = ['germany', 'ussr', 'usa', 'britain'];
            return validCountries.includes(country) ? country : 'other';
        };
    
        const getCountryName = (code) => {
            const countries = {
                germany: '–ì–µ—Ä–º–∞–Ω–∏—è',
                ussr: '–°–°–°–†',
                usa: '–°–®–ê',
                britain: '–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è'
            };
            return countries[code] || '–î—Ä—É–≥–∞—è —Å—Ç—Ä–∞–Ω–∞';
        };
    
        const getTypeName = (code) => {
            const types = {
                heavy: '–¢—è–∂–µ–ª—ã–π',
                medium: '–°—Ä–µ–¥–Ω–∏–π',
                light: '–õ–µ–≥–∫–∏–π',
                'pt-sau': '–ü–¢ –°–ê–£'
            };
            return types[code] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø';
        };
    
        // –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
        const toggleAdminPanel = () => {
            const panel = document.querySelector('.admin-panel');
            panel.classList.toggle('collapsed');
            localStorage.setItem('adminPanelCollapsed', panel.classList.contains('collapsed'));
        };
    
        const handleAddTank = async (e) => {
        e.preventDefault();
        const form = e.target;
        const formData = {
            name: form.elements.name.value,
            country: form.elements.country.value,
            type: form.elements.type.value,
            description: form.elements.description.value,
            image: form.elements.image.value,
            page_url: form.elements.page_url.value,
            speed: form.elements.speed.value,
            engine: form.elements.engine.value,
            armor: form.elements.armor.value,
            armament: form.elements.armament.value,
            productionYears: form.elements.productionYears.value,
            crew: form.elements.crew.value,
            weight: form.elements.weight.value,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        };

        try {
            await db.collection('tanks').add(formData);
            form.reset();
        } catch (error) {
            showError(error);
        }
};
    
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        const showError = (error) => {
            console.error('–û—à–∏–±–∫–∞:', error);
            elements.errorMessage.textContent = getErrorMessage(error.code);
        };
    
        const getErrorMessage = (code) => {
            const messages = {
                'auth/invalid-email': '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email',
                'auth/user-disabled': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω',
                'auth/user-not-found': '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω',
                'auth/wrong-password': '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å',
                'permission-denied': '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤'
            };
            return messages[code] || '–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞';
        };
    
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            const isCollapsed = localStorage.getItem('adminPanelCollapsed') === 'true';
            if(isCollapsed) document.querySelector('.admin-panel').classList.add('collapsed');
            init();
        });
    </script>
</body>
</html>